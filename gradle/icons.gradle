/*
 * Check usage information at: http://hexagonkt.com/gradle/#icons
 */

task("icons").doLast {
    group = "build setup"
    description =
        "Create web icons (favicon and thumbnails for browsers/mobile) from image SVGs (logos)."

    final String logoSmall = findProperty("logoSmall") ?: findProperty("logo")
    final String logoLarge = findProperty("logoLarge") ?: logoSmall
    final String iconsDirectory = findProperty("iconsDirectory") ?: "icons"

    project.file("${buildDir.name}/icons").mkdirs()

    createPng(logoSmall, "$iconsDirectory/favicon.png", 32, 32)
    createPng(logoSmall, "$iconsDirectory/icon-small.png", 180, 180)
    createPng(logoLarge, "$iconsDirectory/icon-large.png", 512, 512)
}

private void createPng(final String svg, final String out, final int width, final int height) {

    exec {
        final String geometry = "${width}x${height}"
        commandLine("convert", "-background", "none", "-resize", geometry, svg, "$buildDir/$out")
    }

    exec {
        commandLine(
            "convert",
            "-gravity", "center",
            "-background", "transparent",
            "-extent", "${width}x${height}",
            "$buildDir/$out",
            "$buildDir/$out"
        )
    }
}
